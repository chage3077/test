# 4.1内存和缓存
## 4.1.1计算机存储设备
<b>|硬盘|内存|缓存
 ---|---|---|---|
用途|长期存储数据，</br>操作计算机的文件、程序、系统|临时存储当前运行的程序（运行内存）|存储CPU经常使用的指令和数据
易失性|断电后数据不会丢失|断电后数据会丢失|断电后数据会丢失
容量|TB级别|GB级别|MB级别
速度|MB/s|几十GB/s|几百GB/s
价格|较便宜|较贵|非常贵

## 4.1.2 数据结构的内存效率
* 内存是有限的，同一块内存不能被多个程序共享
* 随着反复申请与释放内存，空闲内存的碎片化程度会越来越高。链表体现得比较明显。
## 4.1.3 数据结构的缓存效率
* “缓存未命中”：当CPU尝试访问的数据不在缓存区中，就会发生“缓存未命中”，这样会导致CPU读写速度下降。
### 缓存的机制
* 缓存行：缓存以行为单位，高效
* 预取机制：CPU预先预测数据访问模式，根据特定的模式将数据加载至缓存之中，提高“缓存命中率”
* 空间局部性：一处数据被访问，周围的数据也会被访问。
* 时间局部性：一处数据被访问，在后面也会可能再次访问这些数据。（最近访问机制）
### 在缓存机制下对比链表和数组缓存的利用效率
机制|链表|数组|
---|---|---|
占用空间|占用多，需要存储数据和地址|占用少，开辟连续空间即可
缓存行|内存分散，加载慢，且容易加载到无效数据|加载快
预取机制|系统不易预测|系统容易预测即将被加载的数据
空间局部性|加载数据处的附近不易加载|一段连续的内存容易被访问
### 总结
* 数组比链表的缓存效率高，解决算法问题时比较受欢迎。
* 高缓存效率不代表处理算法问题就使用数组，需要根据实际需求进行抉择。
## 4.1.4 数组存储在堆或栈上的区别
* 堆是在代码中进行动态分配的，也就是说可以在代码运行阶段开辟堆内存
```cpp
std::cin>>n; // 动态输入数组大小
int* arr = new int[n]; // 开辟动态数组，此时内存开辟在堆中
```
* 栈是在代码中静态分配的，一般在编译阶段就确定好了，编译器自动分配和释放
```cpp
int arr[3] = {1,2,3}; // 代码中以确定好开辟空间，内存开辟在栈区中
```
### 栈区和堆区特点区别
特性|栈区|堆区|
---|---|---|
分配方式|自动分配与释放|手动分配与释放（new/delete;malloc/free）
分配速度|快速|较慢
生命周期|函数调用期间，函数返回时，栈区内存自动释放|程序员控制，new->delete;malloc->free
内存大小|较小，几MB，太多层的递归或局部变量过大，导致栈溢出|空间大，受系统内存限制
存储内容|局部变量、函数调用信息等|动态分配的对象、数组等
访问效率|较高|较低